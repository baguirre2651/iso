<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In Search Of - The Social Marketplace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f9;
        }
        h1, h2, h3, h4 {
            font-family: 'Manrope', sans-serif;
        }
        .modal-backdrop {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); z-index: 40; backdrop-filter: blur(4px);
        }
        .modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 50; max-height: 90vh; overflow-y: auto;
        }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -48%) scale(0.95); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        .main-content, .detail-view, .how-it-works-view, .leaderboard-view { display: none; }
        .main-content.active, .detail-view.active, .how-it-works-view.active, .leaderboard-view.active { display: block; }
        .upvote-btn.upvoted { background-color: #4f46e5; color: white; }
        .comment-bubble, .chat-bubble {
            max-width: 80%;
            word-wrap: break-word;
        }
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #E5E7EB;
            border-bottom-color: #4f46e5;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .podium-1 { order: 2; transform: translateY(-20px); }
        .podium-2 { order: 1; }
        .podium-3 { order: 3; }
        .upvote-blink {
            animation: upvote-animation 0.5s ease;
        }
        @keyframes upvote-animation {
            50% { 
                background-color: #34d399;
                color: white;
                transform: scale(1.1);
            }
        }
        .chat-message { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .typing-indicator span {
            animation: bob 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bob {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
        .filter-btn.active {
            background-color: #4f46e5;
            color: white;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Main Application Container -->
    <div id="app" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Header -->
        <header class="flex justify-between items-center pb-6 border-b border-gray-200">
            <a href="#" id="logo-link" class="flex items-center space-x-3 text-gray-900 no-underline">
                <div class="bg-indigo-600 text-white w-10 h-10 flex items-center justify-center rounded-lg shadow-md">
                    <i data-lucide="search-check" class="w-6 h-6"></i>
                </div>
                <h1 class="text-2xl md:text-3xl font-bold tracking-tight">In Search Of</h1>
            </a>
             <nav class="hidden md:flex items-center space-x-8">
                <a href="#" class="nav-link active font-semibold text-gray-800" data-view="main-content">Hunts</a>
                <a href="#" class="nav-link text-gray-500 hover:text-gray-800" data-view="leaderboard-view">Leaderboard</a>
                <a href="#" class="nav-link text-gray-500 hover:text-gray-800" data-view="how-it-works-view">How It Works</a>
            </nav>
            <button id="post-iso-btn" class="bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg shadow-sm hover:bg-indigo-700 transition-colors flex items-center space-x-2">
                <i data-lucide="plus-circle" class="w-5 h-5"></i>
                <span class="hidden md:inline">Create ISO</span>
                <span class="md:hidden">Post</span>
            </button>
        </header>
        
        <!-- Mobile Nav -->
        <div class="md:hidden mt-4 mb-4">
             <nav class="flex items-center space-x-6 border-b">
                <a href="#" class="nav-link-mobile active flex-1 text-center py-3 font-semibold text-indigo-600 border-b-2 border-indigo-600" data-view="main-content">Hunts</a>
                <a href="#" class="nav-link-mobile flex-1 text-center py-3 font-semibold text-gray-500" data-view="leaderboard-view">Leaderboard</a>
                <a href="#" class="nav-link-mobile flex-1 text-center py-3 font-semibold text-gray-500" data-view="how-it-works-view">How It Works</a>
            </nav>
        </div>


        <!-- Main Content View (Feed) -->
        <div id="main-content" class="main-content active">
            <div class="py-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-xl font-bold text-gray-900">Community Wanted Board</h2>
                        <p class="text-gray-500 mt-1">Discover what the community is hunting for. Upvote requests you're also interested in!</p>
                    </div>
                </div>
                 <!-- Filters -->
                <div id="filter-bar" class="mt-4 flex space-x-2 overflow-x-auto pb-2">
                    <button class="filter-btn active flex-shrink-0 bg-white text-gray-700 font-semibold py-2 px-4 rounded-full shadow-sm border border-gray-200 hover:bg-gray-100 transition-colors" data-category="All">All</button>
                    <button class="filter-btn flex-shrink-0 bg-white text-gray-700 font-semibold py-2 px-4 rounded-full shadow-sm border border-gray-200 hover:bg-gray-100 transition-colors" data-category="Sneakers">Sneakers</button>
                    <button class="filter-btn flex-shrink-0 bg-white text-gray-700 font-semibold py-2 px-4 rounded-full shadow-sm border border-gray-200 hover:bg-gray-100 transition-colors" data-category="Archival Fashion">Archival Fashion</button>
                    <button class="filter-btn flex-shrink-0 bg-white text-gray-700 font-semibold py-2 px-4 rounded-full shadow-sm border border-gray-200 hover:bg-gray-100 transition-colors" data-category="Collectibles">Collectibles</button>
                    <button class="filter-btn flex-shrink-0 bg-white text-gray-700 font-semibold py-2 px-4 rounded-full shadow-sm border border-gray-200 hover:bg-gray-100 transition-colors" data-category="Watches">Watches</button>
                </div>
            </div>
    
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8 lg:gap-12">
                <!-- ISO Feed Column -->
                <div id="iso-feed" class="lg:col-span-3 space-y-6">
                    <!-- ISO cards will be injected here -->
                </div>
                
                <!-- Sidebar / Community Hub -->
                <aside class="space-y-6">
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                        <h3 class="font-bold text-lg mb-4 text-gray-900">Trending Hunts</h3>
                        <div id="trending-hunts" class="space-y-4">
                            <!-- Trending hunts will be injected here -->
                        </div>
                    </div>
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                        <h3 class="font-bold text-lg mb-4 text-gray-900">Recently Found</h3>
                        <div id="recently-found" class="space-y-4">
                            <!-- Recently found items will be injected here -->
                        </div>
                    </div>
                </aside>
            </div>
        </div>

        <!-- Detail View -->
        <div id="detail-view" class="detail-view">
            <!-- Detail content will be injected here -->
        </div>

        <!-- How It Works View -->
        <div id="how-it-works-view" class="how-it-works-view">
             <div class="py-12 text-center">
                <h2 class="text-3xl font-bold text-gray-900">A Marketplace Built on Demand</h2>
                <p class="text-lg text-gray-500 mt-2 max-w-2xl mx-auto">We flip the traditional model. Instead of sellers listing items, our community of seekers posts what they're looking for first.</p>
            </div>

            <div class="my-12 bg-white p-8 rounded-xl shadow-sm border border-gray-200 max-w-4xl mx-auto">
                <h3 class="text-2xl font-bold text-center text-gray-900 mb-4">Community vs. Commodity</h3>
                <p class="text-center text-gray-600 leading-relaxed">
                    Traditional marketplaces are built for sellers to list inventory. We are a platform built for communities to express demand. We believe that for the most passionate collectors, <span class="font-bold text-indigo-600">the hunt is just as important as the purchase</span>, and our entire model is designed to make that hunt social, exciting, and ultimately, more rewarding for everyone.
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Step 1 -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 text-center flex flex-col">
                    <div class="mx-auto bg-indigo-100 text-indigo-600 w-12 h-12 flex items-center justify-center rounded-full mb-4 flex-shrink-0">
                        <i data-lucide="message-circle" class="w-6 h-6"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">1. Start a Chat</h3>
                    <p class="text-sm text-gray-600">Create your ISO through a guided conversation. Describe what you want, add a reference photo, and set your top offer.</p>
                </div>
                <!-- Step 2 -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 text-center flex flex-col">
                    <div class="mx-auto bg-indigo-100 text-indigo-600 w-12 h-12 flex items-center justify-center rounded-full mb-4 flex-shrink-0">
                        <i data-lucide="send" class="w-6 h-6"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">2. Verify & Syndicate</h3>
                    <p class="text-sm text-gray-600">With simulated fund verification, your ISO becomes an active demand signal. Our engine broadcasts it to seller networks.</p>
                </div>
                <!-- Step 3 -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 text-center flex flex-col">
                    <div class="mx-auto bg-indigo-100 text-indigo-600 w-12 h-12 flex items-center justify-center rounded-full mb-4 flex-shrink-0">
                        <i data-lucide="inbox" class="w-6 h-6"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">3. Receive Private Bids</h3>
                    <p class="text-sm text-gray-600">Verified sellers are notified and submit private bids directly to you. No public price wars, just competitive offers.</p>
                </div>
                <!-- Step 4 -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 text-center flex flex-col">
                    <div class="mx-auto bg-indigo-100 text-indigo-600 w-12 h-12 flex items-center justify-center rounded-full mb-4 flex-shrink-0">
                        <i data-lucide="handshake" class="w-6 h-6"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">4. Close the Deal</h3>
                    <p class="text-sm text-gray-600">Accept the best offer. We'll simulate item verification and escrow to complete the transaction securely.</p>
                </div>
            </div>

            <div class="mt-16">
                 <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-900">Your Demand Syndication Engine</h2>
                    <p class="text-lg text-gray-500 mt-2 max-w-3xl mx-auto">We don't just wait for sellers to find you. We actively broadcast your verified demand to where the sellers are.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                     <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex items-start space-x-4">
                        <div class="bg-green-100 text-green-600 w-12 h-12 flex-shrink-0 flex items-center justify-center rounded-full">
                            <i data-lucide="shield-check" class="w-6 h-6"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg mb-2">Trust & Verification</h3>
                            <p class="text-sm text-gray-600">Fund verification ensures sellers only deal with serious buyers. Escrow protection and item verification protect every transaction.</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex items-start space-x-4">
                        <div class="bg-purple-100 text-purple-600 w-12 h-12 flex-shrink-0 flex items-center justify-center rounded-full">
                            <i data-lucide="sparkles" class="w-6 h-6"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg mb-2">AI-Powered Insights</h3>
                            <p class="text-sm text-gray-600">Powered by Gemini, our AI provides expert commentary on an item's history and market standing to help you make informed decisions.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leaderboard View -->
        <div id="leaderboard-view" class="leaderboard-view">
             <div class="py-12 text-center">
                <h2 class="text-3xl font-bold text-gray-900">Monthly Leaderboard</h2>
                <p class="text-lg text-gray-500 mt-2">Reset in: <span id="countdown-timer" class="font-semibold text-indigo-600">...</span></p>
            </div>
            
            <!-- Podium -->
            <div class="flex flex-col sm:flex-row justify-center items-end gap-4 mb-12">
                <!-- 2nd Place -->
                <div class="podium-2 bg-white p-6 rounded-xl shadow-md border-2 border-gray-300 text-center w-full max-w-xs">
                    <img src="https://i.pravatar.cc/80?u=VintageFinds" class="w-20 h-20 rounded-full mx-auto mb-3 border-4 border-gray-300"/>
                    <p class="font-bold text-lg">@VintageFinds</p>
                    <p class="text-xs text-gray-500">5 Successful Hunts</p>
                    <p class="text-2xl font-bold text-gray-500 mt-2">41,430 pts</p>
                    <p class="font-bold text-gray-400 mt-2">2nd</p>
                </div>
                <!-- 1st Place -->
                <div class="podium-1 bg-white p-8 rounded-xl shadow-lg border-2 border-yellow-400 text-center w-full max-w-xs">
                    <img src="https://i.pravatar.cc/100?u=SoleSeeker" class="w-24 h-24 rounded-full mx-auto mb-3 border-4 border-yellow-400"/>
                    <p class="font-bold text-xl">@SoleSeeker</p>
                    <p class="text-sm text-gray-500">High-Value Watch Collector</p>
                    <p class="text-3xl font-bold text-yellow-500 mt-2">53,430 pts</p>
                    <p class="font-bold text-yellow-400 mt-2">1st 🏆</p>
                </div>
                <!-- 3rd Place -->
                <div class="podium-3 bg-white p-6 rounded-xl shadow-md border-2 border-orange-400 text-center w-full max-w-xs">
                    <img src="https://i.pravatar.cc/80?u=WatchHunterLA" class="w-20 h-20 rounded-full mx-auto mb-3 border-4 border-orange-400"/>
                    <p class="font-bold text-lg">@WatchHunterLA</p>
                    <p class="text-xs text-gray-500">Top Seller</p>
                    <p class="text-2xl font-bold text-orange-500 mt-2">36,864 pts</p>
                    <p class="font-bold text-orange-400 mt-2">3rd</p>
                </div>
            </div>
            
            <div class="my-12 bg-white p-8 rounded-xl shadow-sm border border-gray-200 max-w-4xl mx-auto">
                <h3 class="text-2xl font-bold text-center text-gray-900 mb-2">How to Climb the Ranks</h3>
                <p class="text-gray-600 leading-relaxed mb-6 text-center">
                    Earn points for valuable actions across the marketplace. The more you contribute, the higher you climb.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 text-left text-sm">
                    <div class="p-3 bg-gray-50 rounded-lg"><strong>+50 pts</strong> for creating a "Funds Verified" ISO</div>
                    <div class="p-3 bg-gray-50 rounded-lg"><strong>+1 pt</strong> for each upvote your ISO gets</div>
                    <div class="p-3 bg-gray-50 rounded-lg"><strong>+5 pts</strong> for each private offer you receive</div>
                    <div class="p-3 bg-gray-50 rounded-lg"><strong>+10 pts</strong> for creating any new ISO</div>
                </div>
                <div class="mt-4 p-4 bg-indigo-50 text-indigo-800 rounded-lg text-center">
                    <p class="font-bold">The biggest points come from successful deals!</p>
                    <p class="text-sm">Earn <span class="font-bold">200 points + 1 point per dollar</span> of the final transaction value as both a buyer and a seller.</p>
                </div>
                <div class="mt-8 pt-6 border-t border-gray-200 text-center">
                    <h4 class="font-bold text-lg text-gray-800">Monthly Prizes</h4>
                    <div class="text-sm text-gray-500 mt-2">
                        <span class="font-semibold">🥇 #1:</span> $1,000 | <span class="font-semibold">🥈 #2:</span> $750 | <span class="font-semibold">🥉 #3:</span> $500 | <span class="font-semibold">#4-10:</span> $100
                    </div>
                </div>
            </div>

            <!-- Leaderboard List -->
            <div id="leaderboard-list" class="max-w-4xl mx-auto bg-white p-4 rounded-xl shadow-sm border border-gray-200 space-y-2">
                <!-- Ranks will be injected here -->
            </div>
        </div>

    </div>

    <!-- Modals -->
    <div id="modal-backdrop" class="modal-backdrop"></div>
    
    <!-- New ISO Creation Modal -->
    <div id="iso-modal" class="modal bg-white rounded-xl shadow-2xl w-full max-w-lg">
        <div class="p-4 border-b border-gray-200 flex justify-between items-center">
             <div class="flex items-center space-x-2">
                <h3 class="text-xl font-bold">Create a New ISO</h3>
             </div>
             <button id="close-iso-modal" class="text-gray-400 hover:text-gray-600"><i data-lucide="x" class="w-6 h-6"></i></button>
        </div>
        <!-- Tabs -->
        <div class="border-b border-gray-200">
            <nav class="flex space-x-4" aria-label="Tabs">
                <button id="tab-chat" class="px-3 py-2 font-medium text-sm rounded-t-md text-indigo-600 border-b-2 border-indigo-500">
                    Chat Assistant
                </button>
                <button id="tab-form" class="px-3 py-2 font-medium text-sm rounded-md text-gray-500 hover:text-gray-700">
                    Manual Form
                </button>
            </nav>
        </div>

        <!-- Chat View -->
        <div id="chat-view">
            <div id="chat-log" class="p-6 h-96 overflow-y-auto space-y-4">
                <!-- Chat messages will be injected here -->
            </div>
            <div class="p-4 border-t border-gray-200">
                <div class="flex items-center space-x-2">
                    <input type="text" id="chat-input" placeholder="Type your answer..." class="flex-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-indigo-500" disabled>
                    <button id="chat-submit" class="bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg shadow-sm hover:bg-indigo-700 transition-colors" disabled>Send</button>
                </div>
            </div>
        </div>

        <!-- Form View -->
        <div id="form-view" class="hidden">
            <form id="iso-form" class="p-6 space-y-4">
                <div><label for="item-name" class="block text-sm font-medium text-gray-700">Item Name</label><input type="text" id="item-name" placeholder="e.g., Jordan 1 Retro High 'Chicago'" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></div>
                <div><label for="item-category" class="block text-sm font-medium text-gray-700">Category</label><select id="item-category" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"><option>Sneakers</option><option>Archival Fashion</option><option>Collectibles</option><option>Watches</option></select></div>
                <div><label for="item-details" class="block text-sm font-medium text-gray-700">Details (Size, Condition)</label><input type="text" id="item-details" placeholder="e.g., Size 10, New/Unworn" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></div>
                <div><label for="item-bid" class="block text-sm font-medium text-gray-700">Your Top Offer ($)</label><input type="number" id="item-bid" placeholder="400" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></div>
                <div>
                    <label for="item-image-upload" class="block text-sm font-medium text-gray-700">Reference Image</label>
                    <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                        <div class="space-y-1 text-center">
                            <img id="image-preview" src="" class="hidden mx-auto h-24 w-auto mb-4 rounded-md"/>
                            <svg id="image-upload-icon" class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <div class="flex text-sm text-gray-600">
                                <label for="item-image-upload-input" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
                                    <span>Upload a file</span>
                                    <input id="item-image-upload-input" name="file-upload" type="file" class="sr-only" accept="image/*">
                                </label>
                                <p class="pl-1">or drag and drop</p>
                            </div>
                            <p class="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
                        </div>
                    </div>
                </div>
                <div class="pt-2 flex justify-end"><button type="submit" class="bg-indigo-600 text-white font-semibold px-6 py-2 rounded-lg shadow-sm hover:bg-indigo-700 transition-colors">Submit Request</button></div>
            </form>
        </div>
    </div>
    
    <!-- Sell / Make Offer Modal -->
    <div id="sell-modal" class="modal bg-white rounded-xl shadow-2xl w-full max-w-lg">
        <!-- Sell modal content will be injected here -->
    </div>

    <!-- Edit ISO Modal -->
     <div id="edit-modal" class="modal bg-white rounded-xl shadow-2xl w-full max-w-lg">
        <!-- Edit modal content will be injected here -->
    </div>

    <!-- View Bids Modal -->
    <div id="bids-modal" class="modal bg-white rounded-xl shadow-2xl w-full max-w-2xl">
        <!-- Bids modal content will be injected here -->
    </div>
    
    <!-- AI Insights Modal -->
    <div id="ai-modal" class="modal bg-white rounded-xl shadow-2xl w-full max-w-lg">
        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
            <h3 class="text-xl font-bold flex items-center gap-2">✨ AI Market Insights</h3>
            <button id="close-ai-modal" class="text-gray-400 hover:text-gray-600"><i data-lucide="x" class="w-6 h-6"></i></button>
        </div>
        <div id="ai-modal-content" class="p-6">
            <!-- AI content will be injected here -->
        </div>
    </div>

    <script>
        // Initialize Lucide Icons
        lucide.createIcons();

        // =================================================================================
        // FAKE DATA STORE
        // =================================================================================
        
        let isoData = [
          {
            id: 1,
            name: "Jordan 1 Retro High 'Chicago'",
            category: "Sneakers",
            details: "Size 10, New/Unworn",
            upvotes: 112,
            topOffer: 550,
            comments: 12,
            imageUrl: "images/jordan1.png",
            user: { name: "@sneakerhead23", avatar: "https://i.pravatar.cc/40?u=user3", rating: 4.9 },
            fundsVerified: true,
            privateBids: 0,
            duration: 30,
          },
          {
            id: 6,
            name: "Raf Simons 'Riot' Bomber Jacket",
            category: "Archival Fashion",
            details: "AW 2001, Size 50, Good condition",
            upvotes: 88,
            topOffer: 4500,
            comments: 19,
            imageUrl: "images/raf.png",
            user: { name: "@archive_fiend", avatar: "https://i.pravatar.cc/40?u=user7", rating: 5.0 },
            fundsVerified: true,
            privateBids: 1,
            duration: 14,
          },
          {
            id: 3,
            name: "Margaret Keane: 'Big Eyes' Painting",
            category: "Collectibles",
            details: "1960, 'The Crying Girl'",
            upvotes: 45,
            topOffer: 850,
            comments: 5,
            imageUrl: "images/margret.jpg",
            user: { name: "@artcollectorjane", avatar: "https://i.pravatar.cc/40?u=user5", rating: 5.0 },
            fundsVerified: false,
            privateBids: 0,
            duration: 14,
          },
          {
            id: 4,
            name: "Travis Scott Jordan 1 Low",
            category: "Sneakers",
            details: "Size 9.5, Olive",
            upvotes: 203,
            topOffer: 720,
            comments: 25,
            imageUrl: "images/travis.png",
            user: { name: "@grailHunter", avatar: "https://i.pravatar.cc/40?u=user1", rating: 4.8 },
            fundsVerified: true,
            privateBids: 3,
            duration: 7,
          },
          {
            id: 5,
            name: "Rolex Daytona 'Panda'",
            category: "Watches",
            details: "116500LN, White Dial",
            upvotes: 18,
            topOffer: 28500,
            comments: 32,
            imageUrl: "images/rolexdaytona.png",
            user: { name: "@watchguy", avatar: "https://i.pravatar.cc/40?u=user6", rating: 5.0 },
            fundsVerified: false,
            privateBids: 0,
            duration: 30,
          }
        ];

        const aiInsightsData = {
            "Jordan 1 Retro High 'Chicago'": "The Air Jordan 1 'Chicago' is arguably the most iconic sneaker ever created. Originally released in 1985, its 'Chicago' colorway is a cornerstone of sneaker culture, synonymous with Michael Jordan's rookie season. The 2022 'Reimagined' version added a vintage, aged look that was met with massive commercial success. For collectors, condition and originality are key; a true 1985 pair is a museum piece, while the Reimagined version offers a more accessible entry into its legacy. The market for this shoe is consistently strong, making it a true blue-chip collectible.",
            "Margaret Keane: 'Big Eyes' Painting": "Margaret Keane's Big Eyes paintings are defined by their signature, disproportionately large, doe-like eyes that dominate the canvas. The artworks typically feature women, children, and animals in styles ranging from melancholy and dark to joyful and bright, reflecting different periods of the artist's life.",
            "Kaws: 'Companion' Figure": "Brian Donnelly, known as Kaws, is a pivotal artist bridging the worlds of street art, fine art, and collectibles. His 'Companion' figure, with its signature 'X' eyes, is his most famous creation. Originally produced in Japan in 1999, the Companion has been released in various forms and collaborations. The 2016 Open Edition made the figure more accessible but still highly sought after. It represents a significant moment in the 'art toy' movement, where collectibles are treated with the seriousness of fine art sculptures. Its value is stable and has a global collector base.",
            "Travis Scott Jordan 1 Low": "Travis Scott's collaborations with Nike are among the most influential of the modern era. His take on the Air Jordan 1, characterized by the reversed Swoosh, is his signature design element. These releases create a frenzy in the market due to Scott's cultural influence and the limited production numbers. The 'Olive' and 'Fragment' colorways are particularly coveted. Owning a pair signifies being in-the-know with current sneaker culture. The resale market is highly volatile but consistently high, reflecting its status as a modern classic.",
            "Rolex Daytona 'Panda'": "The Rolex Daytona Ref. 116500LN with a white dial, nicknamed the 'Panda,' is one of the most sought-after luxury watches in the world. Its scarcity is manufactured; authorized dealers have notoriously long waitlists, often spanning years. This drives a hyper-inflated secondary market where the watch trades for more than double its retail price. The watch's appeal comes from its perfect proportions, ceramic bezel, racing heritage, and the status associated with the Rolex brand. It's considered a benchmark 'investment' watch by many collectors due to its strong and consistent value retention."
        };
        
        // =================================================================================
        // DOM ELEMENT SELECTORS
        // =================================================================================
        const app = document.getElementById('app');
        const isoFeed = document.getElementById('iso-feed');
        const recentlyFoundContainer = document.getElementById('recently-found');
        const trendingHuntsContainer = document.getElementById('trending-hunts');
        const mainContent = document.getElementById('main-content');
        const detailView = document.getElementById('detail-view');
        const howItWorksView = document.getElementById('how-it-works-view');
        const leaderboardView = document.getElementById('leaderboard-view');
        const leaderboardList = document.getElementById('leaderboard-list');
        const filterBar = document.getElementById('filter-bar');

        // Modal elements
        const postIsoBtn = document.getElementById('post-iso-btn');
        const isoModal = document.getElementById('iso-modal');
        const sellModal = document.getElementById('sell-modal');
        const editModal = document.getElementById('edit-modal');
        const bidsModal = document.getElementById('bids-modal');
        const aiModal = document.getElementById('ai-modal');
        const aiModalContent = document.getElementById('ai-modal-content');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const closeIsoModalBtn = document.getElementById('close-iso-modal');
        
        // New ISO Modal elements
        const tabChat = document.getElementById('tab-chat');
        const tabForm = document.getElementById('tab-form');
        const chatView = document.getElementById('chat-view');
        const formView = document.getElementById('form-view');
        const chatLog = document.getElementById('chat-log');
        const chatInput = document.getElementById('chat-input');
        const chatSubmit = document.getElementById('chat-submit');

        // Form elements
        const isoForm = document.getElementById('iso-form');
        const imageUploadInput = document.getElementById('item-image-upload-input');
        const imagePreview = document.getElementById('image-preview');
        const imageUploadIcon = document.getElementById('image-upload-icon');

        // =================================================================================
        // CORE FUNCTIONS
        // =================================================================================

        /**
         * Renders the main feed of "In Search Of" cards.
         */
        function renderFeed(filterCategory = 'All') {
            const filteredData = filterCategory === 'All'
                ? isoData
                : isoData.filter(item => item.category === filterCategory);

            isoFeed.innerHTML = '';
            filteredData.sort((a, b) => b.upvotes - a.upvotes).forEach(item => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden';
                const fundsVerifiedBadge = item.fundsVerified 
                    ? `<span class="bg-green-100 text-green-700 text-xs font-bold px-2 py-1 rounded-full flex items-center space-x-1"><i data-lucide="check-circle" class="w-3 h-3"></i><span>Funds Verified</span></span>` 
                    : '';
                const ratingHtml = item.user.rating ? `<span class="text-xs text-gray-500 flex items-center"><i data-lucide="star" class="w-3 h-3 fill-yellow-400 text-yellow-400 mr-1"></i> ${item.user.rating}</span>` : '';

                card.innerHTML = `
                    <div class="p-4 flex justify-between items-start border-b border-gray-100">
                        <div class="flex items-center space-x-3">
                            <img src="${item.user.avatar}" class="w-10 h-10 rounded-full bg-gray-200"/>
                            <div>
                                <p class="font-semibold text-sm text-gray-800">${item.user.name}</p>
                                <div class="flex items-center space-x-2">
                                     ${ratingHtml}
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                           ${fundsVerifiedBadge}
                        </div>
                    </div>
                    <div class="p-4 cursor-pointer" data-id="${item.id}">
                        <div class="h-48 bg-gray-100 rounded-lg flex items-center justify-center mb-4 bg-center bg-cover" style="background-image: url('${item.imageUrl}')">
                        </div>
                        <h3 class="font-bold text-lg truncate text-gray-900">${item.name}</h3>
                        <p class="text-sm text-gray-600 truncate">${item.details}</p>
                        <p class="text-sm font-semibold text-gray-800 mt-2">Top Offer: <span class="text-green-600">$${item.topOffer.toLocaleString()}</span></p>
                    </div>
                    <div class="p-4 border-t border-gray-100 flex justify-between items-center">
                        <div class="flex space-x-4">
                            <button data-id="${item.id}" class="upvote-btn flex items-center space-x-2 text-gray-500 hover:text-indigo-600 transition-colors">
                                <i data-lucide="arrow-up-circle" class="w-5 h-5"></i>
                                <span class="font-semibold text-sm upvote-count">${item.upvotes}</span>
                            </button>
                            <button data-id="${item.id}" class="flex items-center space-x-2 text-gray-500 hover:text-indigo-600 transition-colors">
                                <i data-lucide="message-square" class="w-5 h-5"></i>
                                <span class="font-semibold text-sm">${item.comments}</span>
                            </button>
                        </div>
                        <button data-id="${item.id}" class="view-details-btn text-sm font-semibold text-indigo-600 hover:underline">View Hunt</button>
                    </div>
                `;
                isoFeed.appendChild(card);
            });
            lucide.createIcons();
        }

        /**
         * Renders the "Recently Found" items in the sidebar.
         */
        function renderRecentlyFound() {
            const recentlyFoundData = [
              { name: "Jordan 1 'Chicago'", price: 520, user: "@sneakerhead23", imageUrl: "images/jordan1.png" },
              { name: "Kaws: 'Companion'", user: "@artcollectorjane", imageUrl: "images/kaws.png" }
            ];
            recentlyFoundContainer.innerHTML = '';
            recentlyFoundData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'flex items-center space-x-3';
                div.innerHTML = `
                    <div class="w-16 h-12 bg-gray-100 rounded-md bg-cover bg-center" style="background-image: url('${item.imageUrl}')"></div>
                    <div>
                        <p class="text-sm font-semibold text-gray-800">${item.name}</p>
                        <p class="text-xs text-gray-500">${item.price ? `Found for <span class="font-bold text-green-600">$${item.price}</span> by ${item.user}` : `Sourced for ${item.user}`}</p>
                    </div>
                `;
                recentlyFoundContainer.appendChild(div);
            });
        }

        /**
         * Renders the "Trending Hunts" items in the sidebar.
         */
        function renderTrendingHunts() {
            const trendingData = [...isoData].sort((a, b) => b.upvotes - a.upvotes).slice(0, 3);
            trendingHuntsContainer.innerHTML = '';
            trendingData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'flex flex-col space-y-2';
                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-16 h-12 bg-gray-100 rounded-md bg-cover bg-center" style="background-image: url('${item.imageUrl}')"></div>
                        <div>
                            <p class="text-sm font-semibold text-gray-800">${item.name}</p>
                            <p class="text-xs text-gray-500">${item.upvotes} upvotes</p>
                        </div>
                    </div>
                    <button class="start-similar-btn text-xs font-semibold text-indigo-600 hover:underline text-left">Start a similar hunt</button>
                `;
                trendingHuntsContainer.appendChild(div);
            });
        }

        /**
         * Renders the detailed view for a single item.
         * @param {string | number} itemId - The ID of the item to display.
         */
        function renderDetailView(itemId) {
            const item = isoData.find(i => i.id === parseInt(itemId));
            if (!item) return;

            mainContent.classList.remove('active');
            howItWorksView.classList.remove('active');
            leaderboardView.classList.remove('active');
            
            const ratingHtml = item.user.rating ? `<span class="text-sm text-gray-500 flex items-center"><i data-lucide="star" class="w-4 h-4 fill-yellow-400 text-yellow-400 mr-1"></i> ${item.user.rating} | 5 Successful Hunts</span>` : '';


            const fundsVerifiedBadge = item.fundsVerified 
                ? `<span class="bg-green-100 text-green-800 text-xs font-bold px-2.5 py-1 rounded-full flex items-center space-x-1"><i data-lucide="check-circle" class="w-3 h-3"></i><span>Funds Verified</span></span>` 
                : `<span class="bg-gray-100 text-gray-800 text-xs font-medium px-2.5 py-1 rounded-full">Funds Unverified</span>`;
            
            const syndicationModule = item.fundsVerified ? `
                <div class="mt-8">
                    <h3 class="text-lg font-bold text-gray-900 mb-1">Syndication Engine</h3>
                    <p class="text-sm text-gray-500 mb-4">Broadcasting your demand to verified seller networks.</p>
                    <div id="syndication-channels" class="space-y-3 bg-gray-50 p-4 rounded-lg border">
                        <!-- Syndication channels will be injected here -->
                    </div>
                </div>
            ` : '';
            
            let actionButtons;
            if (item.privateBids > 0) {
                actionButtons = `<button data-item-id="${item.id}" id="view-bids-btn" class="w-full bg-green-600 text-white font-semibold py-3 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center space-x-2"><i data-lucide="gavel" class="w-5 h-5"></i><span>Review ${item.privateBids} Private Offers</span></button>`;
            } else {
                actionButtons = `<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <button data-item-id="${item.id}" class="join-hunt-btn w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition-colors flex items-center justify-center space-x-2"><i data-lucide="user-plus" class="w-5 h-5"></i><span>Join Hunt & Offer</span></button>
                                <button data-item-id="${item.id}" class="sell-item-btn w-full bg-gray-900 text-white font-semibold py-3 rounded-lg hover:bg-gray-800 transition-colors flex items-center justify-center space-x-2"><i data-lucide="tag" class="w-5 h-5"></i><span>I Have This - Sell</span></button>
                             </div>`;
            }

            detailView.innerHTML = `
                <div class="flex justify-between items-center mb-6">
                    <button id="back-to-feed" class="flex items-center space-x-2 text-gray-600 hover:text-gray-900 font-semibold"><i data-lucide="arrow-left" class="w-5 h-5"></i><span>Back to Feed</span></button>
                    <div class="flex items-center space-x-4">
                        <button id="edit-iso-btn" data-id="${item.id}" class="flex items-center space-x-2 text-sm text-gray-600 hover:text-gray-900 font-semibold"><i data-lucide="edit" class="w-4 h-4"></i><span>Edit Hunt</span></button>
                        <button id="delete-iso-btn" data-id="${item.id}" class="flex items-center space-x-2 text-sm text-red-500 hover:text-red-700 font-semibold"><i data-lucide="trash-2" class="w-4 h-4"></i><span>Delete ISO (Demo)</span></button>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-8 lg:gap-12">
                    <div class="bg-white rounded-lg p-4 flex items-center justify-center shadow-lg lg:col-span-2"><img src="${item.imageUrl}" alt="${item.name}" class="max-h-96 object-contain rounded-md"></div>
                    <div class="lg:col-span-3">
                        <div class="flex items-center space-x-3 mb-3">
                            <img src="${item.user.avatar}" class="w-12 h-12 rounded-full"/>
                            <div>
                                <p class="font-semibold text-gray-800">${item.user.name}</p>
                                ${ratingHtml}
                            </div>
                        </div>
                        <h2 class="text-3xl font-bold tracking-tight text-gray-900 mt-1">${item.name}</h2>
                        <p class="text-lg text-gray-600 mt-2">${item.details}</p>
                        
                        <div class="mt-6 bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-sm text-gray-500">Top Offer</p>
                                    <p class="text-3xl font-bold text-gray-900">$${item.topOffer.toLocaleString()}</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm text-gray-500">Community Interest</p>
                                    <p class="text-3xl font-bold text-indigo-600 flex items-center gap-2"><i data-lucide="arrow-up-circle" class="w-7 h-7"></i>${item.upvotes}</p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6 flex items-center space-x-4">${fundsVerifiedBadge}</div>

                        <div class="mt-6 grid grid-cols-1 gap-4">
                             ${actionButtons}
                             <button data-item-name="${item.name}" id="get-ai-insights-btn" class="w-full bg-white border-2 border-indigo-500 text-indigo-600 font-semibold py-3 rounded-lg hover:bg-indigo-50 transition-colors flex items-center justify-center space-x-2">
                                <i data-lucide="sparkles" class="w-5 h-5"></i><span>Get AI Market Insights</span>
                             </button>
                        </div>
                    </div>
                </div>

                ${syndicationModule}

                <!-- Simulated Comments Section -->
                <div class="mt-12">
                    <h3 class="text-xl font-bold mb-4">Community Discussion (${item.comments})</h3>
                    <div class="space-y-6">
                        <div class="flex items-start space-x-3">
                            <img src="https://i.pravatar.cc/40?u=commenter1" class="w-10 h-10 rounded-full"/>
                            <div class="bg-white p-3 rounded-lg border border-gray-200 comment-bubble">
                                <p class="text-sm font-semibold">@vintageVixen</p>
                                <p class="text-gray-700">Absolute grail piece. I've been looking for one in this condition for ages. Upvoted!</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <img src="https://i.pravatar.cc/40?u=commenter2" class="w-10 h-10 rounded-full"/>
                            <div class="bg-white p-3 rounded-lg border border-gray-200 comment-bubble">
                                <p class="text-sm font-semibold">@resell_king</p>
                                <p class="text-gray-700">Good luck with the hunt. The market for these is crazy right now. The top offer is fair but might need to go higher to find one.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            detailView.classList.add('active');
            lucide.createIcons();

            if (item.fundsVerified) {
                startSyndicationAnimation();
            }

            document.getElementById('back-to-feed').addEventListener('click', () => {
                detailView.classList.remove('active');
                mainContent.classList.add('active');
                renderFeed();
            });
            document.getElementById('delete-iso-btn').addEventListener('click', handleDeleteIso);
             document.getElementById('edit-iso-btn').addEventListener('click', handleEditIso);
            document.getElementById('get-ai-insights-btn').addEventListener('click', handleGetAiInsights);
            
            const sellBtn = document.querySelector('.sell-item-btn');
            if (sellBtn) sellBtn.addEventListener('click', handleSellItemClick);

            const viewBidsBtn = document.getElementById('view-bids-btn');
            if (viewBidsBtn) viewBidsBtn.addEventListener('click', handleViewBids);
        }
        
        /**
         * Switches between the main application views.
         */
        function switchView(viewId) {
            document.querySelectorAll('.main-content, .detail-view, .how-it-works-view, .leaderboard-view').forEach(view => {
                view.classList.remove('active');
            });
            document.getElementById(viewId).classList.add('active');

            document.querySelectorAll('.nav-link, .nav-link-mobile').forEach(link => {
                link.classList.remove('active', 'text-gray-800', 'text-indigo-600', 'border-indigo-600');
                if (link.dataset.view === viewId) {
                    link.classList.add('active');
                    if(link.classList.contains('nav-link-mobile')){
                       link.classList.add('text-indigo-600', 'border-b-2', 'border-indigo-600');
                    } else {
                       link.classList.add('text-gray-800');
                    }
                } else {
                    link.classList.add('text-gray-500');
                }
            });
             if(viewId === 'how-it-works-view' || viewId === 'leaderboard-view'){
                 lucide.createIcons();
            }
        }
        
        /**
         * Toggles modal visibility.
         */
        function toggleModal(modal, show) { if (show) { modalBackdrop.style.display = 'block'; modal.style.display = 'block'; modal.classList.add('animate-fade-in'); } else { modal.classList.remove('animate-fade-in'); modal.style.display = 'none'; modalBackdrop.style.display = 'none'; } }
        
        /**
         * Resets the manual form.
         */
        function resetIsoForm() {
            isoForm.reset();
            imagePreview.src = '';
            imagePreview.classList.add('hidden');
            imageUploadIcon.style.display = 'block';
        }

        /**
         * Handles manual form submission.
         */
        function handleIsoSubmit(e) { 
            e.preventDefault(); 
            const imageUrl = imagePreview.src && imagePreview.src.startsWith('data:') ? imagePreview.src : "https://placehold.co/700x500/e2e8f0/4a5568?text=New+Request";
            const newItem = { 
                id: Date.now(), 
                name: document.getElementById('item-name').value, 
                category: document.getElementById('item-category').value, 
                details: document.getElementById('item-details').value, 
                upvotes: 1, 
                topOffer: parseInt(document.getElementById('item-bid').value) || 0, 
                comments: 0, 
                imageUrl: imageUrl,
                user: { name: "@newSeeker", avatar: `https://i.pravatar.cc/40?u=${Date.now()}`, rating: 5.0 },
                fundsVerified: false,
                privateBids: 0,
                duration: 30
            }; 
            isoData.unshift(newItem);
            renderFeed();
            renderTrendingHunts();
            resetIsoForm();
            toggleModal(isoModal, false); 
            switchView('main-content');
        }

        /**
         * Fetches and displays AI insights.
         */
        async function handleGetAiInsights(event) {
            const itemName = event.currentTarget.dataset.itemName;
            toggleModal(aiModal, true);
            aiModalContent.innerHTML = `<div class="flex flex-col items-center justify-center h-48"><div class="loader"></div><p class="mt-4 text-gray-600 font-semibold">Contacting Gemini for insights...</p></div>`;
            const insights = await getAiInsights(itemName);
            aiModalContent.innerHTML = `<div class="space-y-4"><p class="text-gray-700 leading-relaxed">${insights}</p><p class="text-xs text-gray-400 pt-2 border-t border-gray-200">✨ Powered by Gemini. Insights are for informational purposes and are not financial advice.</p></div>`;
        }

        async function getAiInsights(itemName) {
            console.log(`Simulating Gemini API call for: ${itemName}`);
            await new Promise(resolve => setTimeout(resolve, 1500));
            return aiInsightsData[itemName] || "No specific insights available for this item. It is considered a rare collectible within its community.";
        }
        
        /**
         * Opens the sell/make offer modal.
         */
        function handleSellItemClick(event) {
            const itemId = event.currentTarget.dataset.itemId;
            const item = isoData.find(i => i.id === parseInt(itemId));
            if (!item) return;
            sellModal.innerHTML = `
                <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                    <h3 class="text-xl font-bold">Make a Private Offer</h3>
                    <button id="close-sell-modal" class="text-gray-400 hover:text-gray-600"><i data-lucide="x" class="w-6 h-6"></i></button>
                </div>
                <div class="p-6">
                    <p class="text-gray-600 mb-4">You are making a private offer for the <span class="font-bold">${item.name}</span>. Only the buyer will see this.</p>
                    <form id="offer-form" class="space-y-4">
                        <div>
                            <label for="offer-price" class="block text-sm font-medium text-gray-700">Your Offer Price ($)</label>
                            <input type="number" id="offer-price" placeholder="e.g., ${item.topOffer}" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div>
                            <label for="offer-condition" class="block text-sm font-medium text-gray-700">Condition & Details</label>
                            <textarea id="offer-condition" placeholder="e.g., Deadstock, with original box and receipt." required rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                        </div>
                        <div class="pt-4 flex justify-end">
                            <button type="submit" class="bg-indigo-600 text-white font-semibold px-6 py-2 rounded-lg shadow-sm hover:bg-indigo-700 transition-colors">Send Private Offer</button>
                        </div>
                    </form>
                </div>`;
            toggleModal(sellModal, true);
            lucide.createIcons();
            document.getElementById('close-sell-modal').addEventListener('click', () => toggleModal(sellModal, false));
            document.getElementById('offer-form').addEventListener('submit', (e) => {
                e.preventDefault();
                alert(`Your private offer for "${item.name}" has been sent!`);
                toggleModal(sellModal, false);
            });
        }

        /**
         * Opens the modal to view private bids.
         */
        function handleViewBids(event) {
            const itemId = event.currentTarget.dataset.itemId;
            const item = isoData.find(i => i.id === parseInt(itemId));
            if (!item) return;

            // Simulated bids
            const bids = [
                { user: '@resell_king', avatar: 'https://i.pravatar.cc/40?u=resell', price: 710, condition: 'Deadstock with original box. Can ship today.', rating: 4.9 },
                { user: '@sneakerVault', avatar: 'https://i.pravatar.cc/40?u=vault', price: 680, condition: 'VNDS, worn once indoors. Includes extra laces.', rating: 5.0 },
                { user: '@kickzCircle', avatar: 'https://i.pravatar.cc/40?u=kickz', price: 725, condition: 'Perfect condition, OG all. Includes receipt.', rating: 4.7 },
            ];

            const bidsHtml = bids.map(bid => `
                <div class="p-4 border rounded-lg flex items-start space-x-4 hover:bg-gray-50">
                    <img src="${bid.avatar}" class="w-10 h-10 rounded-full mt-1"/>
                    <div class="flex-1">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center space-x-2">
                                <p class="font-semibold text-gray-800">${bid.user}</p>
                                <span class="text-xs text-gray-500 flex items-center"><i data-lucide="star" class="w-3 h-3 fill-yellow-400 text-yellow-400 mr-1"></i> ${bid.rating}</span>
                            </div>
                            <p class="text-2xl font-bold text-green-600">$${bid.price}</p>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">${bid.condition}</p>
                    </div>
                    <div class="flex flex-col space-y-2">
                        <button data-price="${bid.price}" class="accept-offer-btn bg-indigo-600 text-white text-sm font-semibold px-4 py-2 rounded-md hover:bg-indigo-700">Accept Offer</button>
                        <button class="bg-white border border-gray-300 text-gray-700 text-sm font-semibold px-4 py-2 rounded-md hover:bg-gray-100">Counter-offer</button>
                    </div>
                </div>
            `).join('');

            bidsModal.innerHTML = `
                 <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                    <div>
                        <h3 class="text-xl font-bold">Private Offers Received</h3>
                        <p class="text-sm text-gray-500">for ${item.name}</p>
                    </div>
                    <button id="close-bids-modal" class="text-gray-400 hover:text-gray-600"><i data-lucide="x" class="w-6 h-6"></i></button>
                </div>
                <div id="bids-content" class="p-6 bg-gray-50">
                    <div class="space-y-4">${bidsHtml}</div>
                </div>
            `;
            toggleModal(bidsModal, true);
            lucide.createIcons();
            document.getElementById('close-bids-modal').addEventListener('click', () => toggleModal(bidsModal, false));
            document.querySelectorAll('.accept-offer-btn').forEach(btn => {
                btn.addEventListener('click', (e) => handleAcceptOffer(item, e.currentTarget.dataset.price));
            });
        }
        
        /**
         * Simulates accepting an offer and shows shipping options.
         */
        function handleAcceptOffer(item, price) {
            const bidsContent = document.getElementById('bids-content');
            const total = parseInt(price) + 15 + 25; // price + shipping + fee

            bidsContent.innerHTML = `
                <h4 class="text-lg font-bold text-gray-900">Complete Your Purchase</h4>
                <div class="mt-4 space-y-4">
                    <div class="p-4 border rounded-lg bg-white">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Item Price</span>
                            <span class="font-semibold">$${parseInt(price).toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between items-center mt-2">
                            <span class="text-gray-600">ISO Service Fee (5%)</span>
                            <span class="font-semibold">$${(price * 0.05).toLocaleString()}</span>
                        </div>
                         <div class="pt-4 mt-4 border-t">
                            <p class="font-medium mb-2">Shipping Options</p>
                            <div class="space-y-2">
                                <label class="flex items-center p-3 border rounded-md has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500">
                                    <input type="radio" name="shipping" value="15" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500" checked>
                                    <span class="ml-3 text-sm flex-1">Standard Shipping</span>
                                    <span class="font-semibold">$15.00</span>
                                </label>
                                <label class="flex items-center p-3 border rounded-md has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500">
                                    <input type="radio" name="shipping" value="150" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                    <span class="ml-3 text-sm flex-1">Worldnet Secure (Insured)</span>
                                    <span class="font-semibold">$150.00</span>
                                </label>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mt-4 pt-4 border-t-2 border-dashed">
                            <span class="text-lg font-bold">Total</span>
                            <span id="total-price" class="text-lg font-bold">$${(parseInt(price) + (price*0.05) + 15).toLocaleString()}</span>
                        </div>
                    </div>
                    <button id="confirm-purchase-btn" class="w-full bg-green-600 text-white font-semibold py-3 rounded-lg hover:bg-green-700">Confirm Purchase</button>
                </div>
            `;
            
            bidsContent.querySelectorAll('input[name="shipping"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const shippingCost = parseInt(e.target.value);
                    const newTotal = parseInt(price) + (price * 0.05) + shippingCost;
                    document.getElementById('total-price').textContent = `$${newTotal.toLocaleString()}`;
                });
            });

            document.getElementById('confirm-purchase-btn').addEventListener('click', () => {
                alert('Purchase confirmed! Funds will be held in escrow until you receive and verify the item.');
                toggleModal(bidsModal, false);
            });
        }
        
        /**
         * Opens the edit modal for an ISO.
         */
        function handleEditIso(event) {
            const itemId = parseInt(event.currentTarget.dataset.id);
            const item = isoData.find(i => i.id === itemId);
            if (!item) return;

            editModal.innerHTML = `
                <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                    <h3 class="text-xl font-bold">Edit Your Hunt</h3>
                    <button id="close-edit-modal" class="text-gray-400 hover:text-gray-600"><i data-lucide="x" class="w-6 h-6"></i></button>
                </div>
                <form id="edit-form" class="p-6 space-y-4">
                     <div><label for="edit-item-name" class="block text-sm font-medium text-gray-700">Item Name</label><input type="text" id="edit-item-name" value="${item.name}" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></div>
                     <div><label for="edit-item-details" class="block text-sm font-medium text-gray-700">Details</label><input type="text" id="edit-item-details" value="${item.details}" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></div>
                     <div><label for="edit-item-bid" class="block text-sm font-medium text-gray-700">Your Top Offer ($)</label><input type="number" id="edit-item-bid" value="${item.topOffer}" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></div>
                     <div><label for="edit-item-duration" class="block text-sm font-medium text-gray-700">Hunt Duration</label>
                        <select id="edit-item-duration" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                            <option value="7" ${item.duration === 7 ? 'selected' : ''}>7 Days</option>
                            <option value="14" ${item.duration === 14 ? 'selected' : ''}>14 Days</option>
                            <option value="30" ${item.duration === 30 ? 'selected' : ''}>30 Days</option>
                        </select>
                     </div>
                    <div class="pt-2 flex justify-end"><button type="submit" class="bg-indigo-600 text-white font-semibold px-6 py-2 rounded-lg">Save Changes</button></div>
                </form>
            `;
            toggleModal(editModal, true);
            lucide.createIcons();

            document.getElementById('close-edit-modal').addEventListener('click', () => toggleModal(editModal, false));
            document.getElementById('edit-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const itemIndex = isoData.findIndex(i => i.id === itemId);
                if (itemIndex > -1) {
                    isoData[itemIndex].name = document.getElementById('edit-item-name').value;
                    isoData[itemIndex].details = document.getElementById('edit-item-details').value;
                    isoData[itemIndex].topOffer = parseInt(document.getElementById('edit-item-bid').value);
                    isoData[itemIndex].duration = parseInt(document.getElementById('edit-item-duration').value);
                    renderDetailView(itemId); // Re-render the detail view to show changes
                }
                toggleModal(editModal, false);
            });
        }
        
        /**
         * Starts various timers and leaderboards.
         */
        function startCountdown() {
            const countdownElement = document.getElementById('countdown-timer');
            if (!countdownElement) return;
            const endOfMonth = new Date();
            endOfMonth.setMonth(endOfMonth.getMonth() + 1);
            endOfMonth.setDate(0);
            endOfMonth.setHours(23, 59, 59, 999);
            const interval = setInterval(() => {
                const now = new Date().getTime();
                const distance = endOfMonth - now;
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                countdownElement.innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
                if (distance < 0) { clearInterval(interval); countdownElement.innerHTML = "Leaderboard Reset!"; }
            }, 1000);
        }
        
        function renderLeaderboard() {
            const leaderboardData = [ { rank: 4, name: 'TokyoHypeBeast', score: 35514 }, { rank: 5, name: 'KicksCanada', score: 33504 }, { rank: 6, name: 'GrailCollector', score: 33288 }, { rank: 7, name: 'TimelessPieces', score: 27462 }, { rank: 8, name: 'TheCardboardKing', score: 26310 }, { rank: 9, name: 'ArtToyAddict', score: 26022 }, { rank: 10, name: 'StreetwearArchives', score: 25200 }, ];
            leaderboardList.innerHTML = '';
            leaderboardData.forEach(player => {
                const item = document.createElement('div');
                item.className = 'flex items-center p-3 rounded-lg hover:bg-gray-50';
                item.innerHTML = `<div class="w-8 text-gray-500 font-bold text-sm">#${player.rank}</div><img src="https://i.pravatar.cc/40?u=${player.name}" class="w-10 h-10 rounded-full mx-4"/><div class="flex-grow font-semibold text-gray-800">${player.name}</div><div class="font-bold text-indigo-600 text-sm">${player.score.toLocaleString()} pts</div>`;
                leaderboardList.appendChild(item);
            });
        }

        // =================================================================================
        // NEW CHAT & SYNDICATION LOGIC
        // =================================================================================
        let currentChatStep = 0;
        let isoInProgress = {};
        const chatFlow = [
            { bot: "Hey! I'll help create your ISO. What are you searching for?", key: 'name', placeholder: "e.g., Jordan 1 'Chicago'" },
            { bot: "Got it. Any specific details? (Size, condition, etc.)", key: 'details', placeholder: "e.g., Size 10, New" },
            { bot: "Which category does this fall under?", action: 'category' },
            { bot: "What's the top offer you'd like to make for this item?", key: 'topOffer', placeholder: "$550" },
            { bot: "A picture is worth a thousand words! Please upload a reference image for your hunt.", action: 'image' },
            { bot: "Great. To ensure sellers know you're serious, we'll simulate a fund verification. This signals you're a ready buyer.", action: 'verify' },
            { bot: "Perfect! Your funds are verified. We are now syndicating your ISO to our network of sellers.", action: 'syndicate' }
        ];

        function startChat() {
            currentChatStep = 0;
            isoInProgress = {};
            chatLog.innerHTML = '';
            addBotMessage(chatFlow[0].bot);
            chatInput.placeholder = chatFlow[0].placeholder;
            chatInput.disabled = false;
            chatSubmit.disabled = false;
            chatInput.focus();
        }

        function addMessage(content, isUser = false) {
            const messageWrapper = document.createElement('div');
            messageWrapper.className = `chat-message flex ${isUser ? 'justify-end' : 'justify-start'}`;
            const bubble = document.createElement('div');
            bubble.className = `chat-bubble p-3 rounded-2xl text-sm ${isUser ? 'bg-indigo-600 text-white rounded-br-none' : 'bg-gray-200 text-gray-800 rounded-bl-none'}`;
            bubble.innerHTML = content;
            messageWrapper.appendChild(bubble);
            chatLog.appendChild(messageWrapper);
            chatLog.scrollTop = chatLog.scrollHeight;
        }
        
        function addBotMessage(text) {
            addMessage(text, false);
        }

        function addUserMessage(text) {
            addMessage(text, true);
        }

        function handleChatSubmission() {
            const userText = chatInput.value.trim();
            if (!userText) return;

            addUserMessage(userText);
            const currentStep = chatFlow[currentChatStep];
            if (currentStep.key) {
                isoInProgress[currentStep.key] = userText;
            }

            chatInput.value = '';
            chatInput.disabled = true;
            chatSubmit.disabled = true;

            currentChatStep++;
            processNextChatStep();
        }
        
        function processNextChatStep() {
            const nextStep = chatFlow[currentChatStep];
            if (!nextStep) {
                chatInput.placeholder = "All done!";
                return;
            }
            
            const typingIndicator = `<div class="chat-message flex justify-start"><div class="chat-bubble p-3 rounded-2xl bg-gray-200"><div class="typing-indicator flex items-center space-x-1"><span></span><span></span><span></span></div></div></div>`;
            chatLog.innerHTML += typingIndicator;
            chatLog.scrollTop = chatLog.scrollHeight;

            setTimeout(() => {
                chatLog.removeChild(chatLog.lastChild);
                addBotMessage(nextStep.bot);
                
                if (nextStep.action === 'category') {
                     const categories = ['Sneakers', 'Archival Fashion', 'Collectibles', 'Watches'];
                     const categoryButtonsHTML = `
                        <div class="flex flex-wrap gap-2 mt-2">
                            ${categories.map(cat => `<button class="chat-category-btn bg-white border border-gray-300 text-gray-700 text-sm font-semibold py-1 px-3 rounded-full hover:bg-gray-100">${cat}</button>`).join('')}
                        </div>
                     `;
                     addMessage(categoryButtonsHTML, false);
                     document.querySelectorAll('.chat-category-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const category = btn.textContent;
                            isoInProgress.category = category;
                            addUserMessage(category);
                            currentChatStep++;
                            processNextChatStep();
                        });
                     });
                } else if (nextStep.action === 'image') {
                    const imageUploaderHTML = `
                        <div class="mt-2 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                            <div class="space-y-1 text-center">
                                <img id="chat-image-preview" src="" class="hidden mx-auto h-24 w-auto mb-4 rounded-md"/>
                                <svg id="chat-image-upload-icon" class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <div class="flex text-sm text-gray-600">
                                    <label for="chat-image-upload-input" class="relative cursor-pointer bg-gray-200 rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500 px-1">
                                        <span>Upload a file</span>
                                        <input id="chat-image-upload-input" name="file-upload" type="file" class="sr-only" accept="image/*">
                                    </label>
                                </div>
                                <p class="text-xs text-gray-500">PNG, JPG up to 10MB</p>
                            </div>
                        </div>`;
                    addMessage(imageUploaderHTML, false);
                    document.getElementById('chat-image-upload-input').addEventListener('change', handleChatImageUpload);
                } else if (nextStep.action === 'verify') {
                    setTimeout(() => {
                        const successMsg = `<div class="flex items-center space-x-2"><i data-lucide="check-circle" class="w-5 h-5 text-green-500"></i><p>Funds Verified!</p></div>`;
                        addMessage(successMsg, false);
                        lucide.createIcons();
                        currentChatStep++;
                        processNextChatStep();
                    }, 2000);
                } else if (nextStep.action === 'syndicate') {
                    setTimeout(() => {
                        createNewIsoFromChat();
                        toggleModal(isoModal, false);
                    }, 2000);
                } else {
                    chatInput.placeholder = nextStep.placeholder;
                    chatInput.disabled = false;
                    chatSubmit.disabled = false;
                    chatInput.focus();
                }
            }, 1500);
        }
        
        function createNewIsoFromChat() {
            const newItem = {
                id: Date.now(),
                name: isoInProgress.name,
                details: isoInProgress.details,
                topOffer: parseInt(isoInProgress.topOffer.replace(/\D/g,'')) || 0,
                category: isoInProgress.category || "Uncategorized",
                upvotes: 1,
                comments: 0,
                imageUrl: isoInProgress.imageUrl || "https://placehold.co/700x500/e2e8f0/4a5568?text=New+Hunt",
                user: { name: "@newSeeker", avatar: `https://i.pravatar.cc/40?u=${Date.now()}`, rating: 5.0 },
                fundsVerified: true,
                privateBids: 0,
                duration: 30
            };
            isoData.unshift(newItem);
            renderFeed();
            renderTrendingHunts();
            switchView('main-content');
        }

        function handleChatImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                isoInProgress.imageUrl = event.target.result;
                const preview = document.getElementById('chat-image-preview');
                const icon = document.getElementById('chat-image-upload-icon');
                if (preview) {
                    preview.src = event.target.result;
                    preview.classList.remove('hidden');
                }
                if (icon) icon.style.display = 'none';

                currentChatStep++;
                processNextChatStep();
            };
            reader.readAsDataURL(file);
        }

        function startSyndicationAnimation() {
            const container = document.getElementById('syndication-channels');
            if (!container) return;
            
            const channels = [
                { name: 'Instagram Dealer Network', count: '47 dealers' },
                { name: 'Discord Collector Groups', count: '8 communities' },
                { name: 'Facebook Collector Groups', count: '15 groups' },
                { name: 'Verified Email Network', count: '1,200+ sellers' }
            ];
            
            container.innerHTML = ''; 
            
            channels.forEach((channel, index) => {
                setTimeout(() => {
                    const channelDiv = document.createElement('div');
                    channelDiv.className = 'flex items-center justify-between text-sm opacity-0 transition-opacity duration-500';
                    channelDiv.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <div class="loader !w-4 !h-4 !border-2"></div>
                            <span class="font-medium text-gray-700">${channel.name}</span>
                        </div>
                        <span class="text-gray-500" id="status-${index}">Broadcasting...</span>`;
                    container.appendChild(channelDiv);
                    setTimeout(() => channelDiv.classList.remove('opacity-0'), 10);
                    
                    setTimeout(() => {
                        const statusEl = document.getElementById(`status-${index}`);
                        const loaderEl = channelDiv.querySelector('.loader');
                        if (loaderEl) loaderEl.style.display = 'none';
                        channelDiv.querySelector('.flex').insertAdjacentHTML('afterbegin', `<i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i>`);
                        if (statusEl) {
                           statusEl.textContent = `✓ Syndicated (${channel.count})`;
                           statusEl.classList.add('font-semibold', 'text-green-600');
                        }
                        lucide.createIcons();
                    }, 1500 + (index * 500));
                }, index * 1000);
            });
        }

        function handleDeleteIso(event) {
            const itemId = parseInt(event.currentTarget.dataset.id);
            const itemIndex = isoData.findIndex(item => item.id === itemId);
            if (itemIndex > -1) {
                isoData.splice(itemIndex, 1);
                switchView('main-content');
                renderFeed();
                renderTrendingHunts();
            }
        }

        // =================================================================================
        // EVENT LISTENERS
        // =================================================================================

        postIsoBtn.addEventListener('click', () => {
            toggleModal(isoModal, true);
            startChat();
        });

        closeIsoModalBtn.addEventListener('click', () => toggleModal(isoModal, false));
        modalBackdrop.addEventListener('click', () => {
            toggleModal(isoModal, false);
            toggleModal(sellModal, false);
            toggleModal(aiModal, false);
            toggleModal(bidsModal, false);
            toggleModal(editModal, false);
        });
        document.getElementById('close-ai-modal').addEventListener('click', () => toggleModal(aiModal, false));
        
        tabChat.addEventListener('click', () => {
            tabChat.classList.add('text-indigo-600', 'border-indigo-500');
            tabChat.classList.remove('text-gray-500');
            tabForm.classList.remove('text-indigo-600', 'border-indigo-500');
            tabForm.classList.add('text-gray-500');
            chatView.classList.remove('hidden');
            formView.classList.add('hidden');
        });

        tabForm.addEventListener('click', () => {
            tabForm.classList.add('text-indigo-600', 'border-indigo-500');
            tabForm.classList.remove('text-gray-500');
            tabChat.classList.remove('text-indigo-600', 'border-indigo-500');
            tabChat.classList.add('text-gray-500');
            formView.classList.remove('hidden');
            chatView.classList.add('hidden');
        });
        
        chatSubmit.addEventListener('click', handleChatSubmission);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleChatSubmission();
        });

        isoForm.addEventListener('submit', handleIsoSubmit);

        imageUploadInput.addEventListener('change', () => {
            const file = imageUploadInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                    imagePreview.classList.remove('hidden');
                    imageUploadIcon.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        });

        isoFeed.addEventListener('click', (event) => {
            const viewBtn = event.target.closest('.view-details-btn');
            const cardBody = event.target.closest('.cursor-pointer');
            const upvoteBtn = event.target.closest('.upvote-btn');

            if (viewBtn || cardBody) {
                const id = viewBtn ? viewBtn.dataset.id : cardBody.dataset.id;
                renderDetailView(id);
            } else if (upvoteBtn) {
                upvoteBtn.classList.add('upvote-blink');
                setTimeout(() => upvoteBtn.classList.remove('upvote-blink'), 500);
                const itemId = parseInt(upvoteBtn.dataset.id);
                const item = isoData.find(i => i.id === itemId);
                if (item) {
                    if (!upvoteBtn.classList.contains('upvoted')) {
                        item.upvotes++;
                        upvoteBtn.classList.add('upvoted');
                    } else {
                        item.upvotes--;
                        upvoteBtn.classList.remove('upvoted');
                    }
                    upvoteBtn.querySelector('.upvote-count').textContent = item.upvotes;
                }
            }
        });
        
        detailView.addEventListener('click', (event) => {
            const sellBtn = event.target.closest('.sell-item-btn');
            const viewBidsBtn = event.target.closest('#view-bids-btn');
            if (sellBtn) handleSellItemClick(event);
            if (viewBidsBtn) handleViewBids(event);
        });

        app.addEventListener('click', (e) => {
             const navLink = e.target.closest('.nav-link, .nav-link-mobile');
             if(navLink) {
                 e.preventDefault();
                 switchView(navLink.dataset.view);
             }
             const similarBtn = e.target.closest('.start-similar-btn');
             if(similarBtn) {
                toggleModal(isoModal, true);
                startChat();
             }
        });
        
        document.getElementById('logo-link').addEventListener('click', (e) => {
            e.preventDefault();
            switchView('main-content');
        });

        filterBar.addEventListener('click', (e) => {
            if (e.target.classList.contains('filter-btn')) {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                renderFeed(e.target.dataset.category);
            }
        });

        // --- INITIAL RENDER ---
        function initializeApp() {
            renderFeed();
            renderRecentlyFound();
            renderTrendingHunts();
            renderLeaderboard();
            startCountdown();
            mainContent.classList.add('active');
        }

        initializeApp();
    </script>
</body>
</html>

